<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Portfolio Manager</title>
    <link rel="stylesheet" href="unified.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="light">

<div class="container">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h1 class="logo">
                <span class="logo-icon"></span>
                <span>Portfolio Manager</span>
            </h1>
        </div>

        <nav class="sidebar-nav">
            <a class="nav-link active" href="dashboard.html">
                <span class="nav-icon"></span>
                <span>Dashboard</span>
            </a>
            <a class="nav-link" href="index.html">
                <span class="nav-icon"></span>
                <span>Goal Planning</span>
            </a>
            <a class="nav-link" href="trending-news.html">
                <span class="nav-icon"></span>
                <span>Trending News</span>
            </a>
        </nav>

        <div class="sidebar-info">
            <h3>üí° Portfolio Insights</h3>
            <p>Track your US stock investments in real-time with live market prices powered by Finnhub.</p>
            <ul class="feature-list">
                <li>‚úì Live US stock prices</li>
                <li>‚úì Custom ticker input</li>
                <li>‚úì Performance tracking</li>
                <li>‚úì P/L analysis</li>
            </ul>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="top-bar">
            <div class="header-content">
                <div>
                    <h2 class="page-title">Investment Dashboard</h2>
                    <p class="page-subtitle">Monitor your US stock portfolio performance</p>
                </div>

                <div class="header-stats">
                    <div class="stat-pill">
                        <span class="stat-label">Total Value</span>
                        <strong id="totalValue" class="stat-value">$0.00</strong>
                    </div>
                    <div class="stat-pill">
                        <span class="stat-label">Total Return</span>
                        <strong id="totalReturn" class="stat-value positive">+0%</strong>
                    </div>
                    <div class="stat-pill">
                        <span class="stat-label">Last Updated</span>
                        <strong id="lastUpdated" class="stat-value" style="font-size: 0.875rem;">--</strong>
                    </div>
                </div>

                <div class="header-actions">
                    <button class="btn-refresh" onclick="refreshPrices()" title="Refresh Prices">
                        <span class="refresh-icon">üîÑ</span>
                    </button>
                    <button class="btn-alert" onclick="openAlertModal()" title="Price Alerts">
                        <span class="alert-icon">üîî</span>
                        <span class="alert-badge" id="alertBadge" style="display: none;">0</span>
                    </button>
                    <button class="btn-primary" onclick="openModal()">
                        <span class="btn-icon">+</span>
                        Add Stock
                    </button>
                    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
                        <span class="theme-icon">üåô</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Content Grid -->
        <div class="content-grid">
            <!-- Summary Cards -->
            <div class="summary-grid">
                <div class="summary-card stocks">
                    <div class="summary-icon">üìà</div>
                    <div class="summary-info">
                        <h4>Total Stocks Value</h4>
                        <p id="stocksValue" class="summary-value">$0.00</p>
                    </div>
                </div>
                <div class="summary-card mutual-funds">
                    <div class="summary-icon">üí∞</div>
                    <div class="summary-info">
                        <h4>Total Profit/Loss</h4>
                        <p id="totalPL" class="summary-value">$0.00</p>
                    </div>
                </div>
                <div class="summary-card gold">
                    <div class="summary-icon">üìä</div>
                    <div class="summary-info">
                        <h4>Holdings Count</h4>
                        <p id="holdingsCount" class="summary-value">0</p>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-grid">
                <div class="card chart-card">
                    <div class="card-header">
                        <div>
                            <h3 class="card-title">Portfolio Allocation</h3>
                            <p class="card-subtitle">Distribution by stock value</p>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="allocationChart"></canvas>
                    </div>
                </div>

                <div class="card chart-card">
                    <div class="card-header">
                        <div>
                            <h3 class="card-title">Performance</h3>
                            <p class="card-subtitle">Profit/Loss by stock</p>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
            </div>


            <!-- Holdings Table -->
            <div class="card table-card">
                <div class="card-header">
                    <div>
                        <h3 class="card-title">Your Holdings</h3>
                        <p class="card-subtitle">All US stocks in your portfolio</p>
                    </div>
                    <div class="price-status">
                        <span class="status-indicator" id="priceStatus">
                            <span class="status-dot"></span>
                            <span>Live Prices</span>
                        </span>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="holdings-table">
                        <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Company</th>
                            <th>Shares</th>
                            <th>Avg Cost</th>
                            <th>Current Price</th>
                            <th>Market Value</th>
                            <th>P/L</th>
                            <th>P/L %</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody id="holdingsTableBody">
                        <tr class="empty-state">
                            <td colspan="9">
                                <div class="empty-message">
                                    <span class="empty-icon">üìä</span>
                                    <p>No stocks yet. Add your first US stock to get started!</p>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Add Stock Modal -->
<div id="addAssetModal" class="modal hidden">
    <div class="modal-overlay" onclick="closeModal()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add US Stock</h3>
            <button class="modal-close" onclick="closeModal()" aria-label="Close modal">&times;</button>
        </div>

        <form class="modal-form" onsubmit="event.preventDefault(); submitAsset();">
            <!-- Mode Toggle -->
            <div class="form-group">
                <div class="input-mode-toggle">
                    <button type="button" class="toggle-btn active" id="presetBtn" onclick="switchToPreset()">
                        üìã Popular Stocks
                    </button>
                    <button type="button" class="toggle-btn" id="customBtn" onclick="switchToCustom()">
                        ‚úèÔ∏è Enter Ticker
                    </button>
                </div>
            </div>

            <!-- Preset Selection Mode -->
            <div id="presetMode">
                <div class="form-group">
                    <label for="assetSelect">Select Stock *</label>
                    <select id="assetSelect" onchange="handleAssetSelection()">
                        <option value="">-- Choose a stock --</option>
                        <optgroup label="Tech Giants">
                            <option value="AAPL">AAPL - Apple Inc.</option>
                            <option value="MSFT">MSFT - Microsoft Corporation</option>
                            <option value="GOOGL">GOOGL - Alphabet Inc.</option>
                            <option value="AMZN">AMZN - Amazon.com Inc.</option>
                            <option value="META">META - Meta Platforms Inc.</option>
                            <option value="NVDA">NVDA - NVIDIA Corporation</option>
                            <option value="TSLA">TSLA - Tesla Inc.</option>
                        </optgroup>
                        <optgroup label="Financial Services">
                            <option value="JPM">JPM - JPMorgan Chase & Co.</option>
                            <option value="V">V - Visa Inc.</option>
                            <option value="MA">MA - Mastercard Inc.</option>
                            <option value="BAC">BAC - Bank of America Corp.</option>
                        </optgroup>
                        <optgroup label="Healthcare">
                            <option value="JNJ">JNJ - Johnson & Johnson</option>
                            <option value="UNH">UNH - UnitedHealth Group</option>
                            <option value="PFE">PFE - Pfizer Inc.</option>
                        </optgroup>
                        <optgroup label="Consumer">
                            <option value="WMT">WMT - Walmart Inc.</option>
                            <option value="PG">PG - Procter & Gamble Co.</option>
                            <option value="KO">KO - The Coca-Cola Company</option>
                            <option value="NKE">NKE - Nike Inc.</option>
                        </optgroup>
                    </select>
                </div>
            </div>

            <!-- Custom Ticker Mode -->
            <div id="customMode" style="display: none;">
                <div class="form-group">
                    <label for="customTicker">Enter Ticker Symbol *</label>
                    <div class="ticker-input-group">
                        <input
                                id="customTicker"
                                type="text"
                                placeholder="e.g., AAPL, MSFT, GOOGL"
                                onkeyup="this.value = this.value.toUpperCase()">
                        <button type="button" class="btn-fetch" onclick="fetchTickerInfo()">
                            üîç Fetch
                        </button>
                    </div>
                    <small class="helper-text">
                        üí° Enter any US stock ticker (NYSE, NASDAQ)
                    </small>
                </div>

                <div id="tickerInfoDisplay" style="display: none;">
                    <div class="ticker-info-card">
                        <div class="info-row">
                            <span class="info-label">Symbol:</span>
                            <span class="info-value" id="displaySymbol">--</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Company:</span>
                            <span class="info-value" id="displayName">--</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Current Price:</span>
                            <span class="info-value price-highlight" id="displayPrice">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hidden Fields -->
            <input id="symbol" type="hidden">
            <input id="holdingName" type="hidden">
            <input id="price" type="hidden">

            <!-- Shares Input -->
            <div class="form-group">
                <label for="quantity">Number of Shares *</label>
                <input id="quantity" type="number" placeholder="Enter number of shares" min="0.01" step="0.01" required>
            </div>

            <!-- Price Display -->
            <div class="current-price-display" id="currentPriceDisplay" style="display: none;">
                <div class="price-info-box">
                    <div class="price-info">
                        <span class="price-label">Purchase Price:</span>
                        <span class="price-value" id="modalCurrentPrice">--</span>
                    </div>
                    <div class="price-note">
                        <small>Current market price will be used</small>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div class="loading-price" id="loadingPrice" style="display: none;">
                <div class="loading-spinner"></div>
                <span>Fetching live price...</span>
            </div>

            <!-- Form Actions -->
            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
                <button type="submit" class="btn-primary">Add to Portfolio</button>
            </div>
        </form>
    </div>
</div>

<!-- Price Alert Modal -->
<div id="alertModal" class="modal hidden">
    <div class="modal-overlay" onclick="closeAlertModal()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>üîî Price Alerts</h3>
            <button class="modal-close" onclick="closeAlertModal()" aria-label="Close modal">&times;</button>
        </div>

        <div class="modal-body">
            <!-- Create New Alert Section -->
            <div class="alert-create-section">
                <h4>Create New Alert</h4>
                <form class="alert-form" onsubmit="event.preventDefault(); createAlert();">
                    <div class="form-group">
                        <label for="alertStock">Select Stock *</label>
                        <select id="alertStock" required>
                            <option value="">-- Choose a stock from your portfolio --</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="alertType">Alert Type *</label>
                            <select id="alertType" required>
                                <option value="above">Price Above</option>
                                <option value="below">Price Below</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="alertPrice">Target Price ($) *</label>
                            <input id="alertPrice" type="number" placeholder="0.00" min="0.01" step="0.01" required>
                        </div>
                    </div>

                    <div class="alert-current-price" id="alertCurrentPriceDisplay" style="display: none;">
                        <span class="alert-label">Current Price:</span>
                        <span class="alert-value" id="alertCurrentPriceValue">--</span>
                    </div>

                    <button type="submit" class="btn-primary" style="width: 100%; margin-top: 1rem;">
                        ‚ûï Create Alert
                    </button>
                </form>
            </div>

            <!-- Active Alerts Section -->
            <div class="alert-list-section">
                <h4>Active Alerts (<span id="alertCount">0</span>)</h4>
                <div id="alertList" class="alert-list">
                    <div class="empty-message" style="padding: 2rem; text-align: center;">
                        <span class="empty-icon">üîî</span>
                        <p>No active alerts. Create one to get notified!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="dashboard.js"></script>
<script>
    // Theme initialization
    document.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('theme') || 'light';
        const themeIcon = document.querySelector('.theme-icon');

        document.body.classList.remove('light', 'dark');
        document.body.classList.add(savedTheme);
        themeIcon.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    });
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Portfolio Manager</title>
    <link rel="stylesheet" href="unified.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="light">

<div class="container">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h1 class="logo">
                <span class="logo-icon">üíº</span>
                <span>Portfolio Manager</span>
            </h1>
        </div>

        <nav class="sidebar-nav">
            <a class="nav-link active" href="dashboard.html">
                <span class="nav-icon">üìä</span>
                <span>Dashboard</span>
            </a>
            <a class="nav-link" href="index.html">
                <span class="nav-icon">üéØ</span>
                <span>Goal Planning</span>
            </a>
        </nav>

        <div class="sidebar-info">
            <h3>üí° Portfolio Insights</h3>
            <p>Track your investments in real-time with live market prices and comprehensive analytics.</p>
            <ul class="feature-list">
                <li>‚úì Live price updates</li>
                <li>‚úì Performance tracking</li>
                <li>‚úì Asset allocation</li>
                <li>‚úì P/L analysis</li>
            </ul>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="top-bar">
            <div class="header-content">
                <div>
                    <h2 class="page-title">Investment Dashboard</h2>
                    <p class="page-subtitle">Monitor your portfolio performance</p>
                </div>

                <div class="header-stats">
                    <div class="stat-pill">
                        <span class="stat-label">Total Value</span>
                        <strong id="totalValue" class="stat-value">‚Çπ0.00</strong>
                    </div>
                    <div class="stat-pill">
                        <span class="stat-label">Total Return</span>
                        <strong id="totalReturn" class="stat-value positive">+0%</strong>
                    </div>
                    <div class="stat-pill">
                        <span class="stat-label">Last Updated</span>
                        <strong id="lastUpdated" class="stat-value" style="font-size: 0.875rem;">--</strong>
                    </div>
                </div>

                <div class="header-actions">
                    <button class="btn-refresh" onclick="refreshPrices()" title="Refresh Prices">
                        <span class="refresh-icon">üîÑ</span>
                    </button>
                    <button class="btn-primary" onclick="openModal()">
                        <span class="btn-icon">+</span>
                        Add Asset
                    </button>
                    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
                        <span class="theme-icon">üåô</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Content Grid -->
        <div class="content-grid">
            <!-- Summary Cards -->
            <div class="summary-grid">
                <div class="summary-card stocks">
                    <div class="summary-icon">üìà</div>
                    <div class="summary-info">
                        <h4>Stocks</h4>
                        <p id="stocksValue" class="summary-value">‚Çπ0.00</p>
                    </div>
                </div>
                <div class="summary-card mutual-funds">
                    <div class="summary-icon">üí∞</div>
                    <div class="summary-info">
                        <h4>Mutual Funds</h4>
                        <p id="mfValue" class="summary-value">‚Çπ0.00</p>
                    </div>
                </div>
                <div class="summary-card gold">
                    <div class="summary-icon">ü™ô</div>
                    <div class="summary-info">
                        <h4>Gold</h4>
                        <p id="goldValue" class="summary-value">‚Çπ0.00</p>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-grid">
                <div class="card chart-card">
                    <div class="card-header">
                        <div>
                            <h3 class="card-title">Asset Allocation</h3>
                            <p class="card-subtitle">Distribution by type</p>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="allocationChart"></canvas>
                    </div>
                </div>

                <div class="card chart-card">
                    <div class="card-header">
                        <div>
                            <h3 class="card-title">Performance</h3>
                            <p class="card-subtitle">Profit/Loss by asset</p>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Holdings Table -->
            <div class="card table-card">
                <div class="card-header">
                    <div>
                        <h3 class="card-title">Your Holdings</h3>
                        <p class="card-subtitle">All assets in your portfolio</p>
                    </div>
                    <div class="price-status">
                        <span class="status-indicator" id="priceStatus">
                            <span class="status-dot"></span>
                            <span>Live Prices</span>
                        </span>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="holdings-table">
                        <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Name</th>
                            <th>Quantity</th>
                            <th>Purchase Price</th>
                            <th>Current Price</th>
                            <th>Value</th>
                            <th>P/L</th>
                            <th>P/L %</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody id="holdingsTableBody">
                        <tr class="empty-state">
                            <td colspan="9">
                                <div class="empty-message">
                                    <span class="empty-icon">üìä</span>
                                    <p>No holdings yet. Add your first asset to get started!</p>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Add Asset Modal -->
<div id="addAssetModal" class="modal hidden">
    <div class="modal-overlay" onclick="closeModal()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add New Asset</h3>
            <button class="modal-close" onclick="closeModal()" aria-label="Close modal">&times;</button>
        </div>

        <form class="modal-form" onsubmit="event.preventDefault(); submitAsset();">
            <div class="form-group">
                <label for="assetSelect">Select Asset *</label>
                <select id="assetSelect" required onchange="handleAssetSelection()">
                    <option value="">-- Choose an asset --</option>
                    <optgroup label="Stocks">
                        <option value="TCS|Tata Consultancy Services|STOCK">TCS - Tata Consultancy Services</option>
                        <option value="RELIANCE|Reliance Industries|STOCK">RELIANCE - Reliance Industries</option>
                        <option value="HDFCBANK|HDFC Bank|STOCK">HDFCBANK - HDFC Bank</option>
                        <option value="ICICIBANK|ICICI Bank|STOCK">ICICIBANK - ICICI Bank</option>
                        <option value="INFY|Infosys|STOCK">INFY - Infosys</option>
                        <option value="SBIN|State Bank of India|STOCK">SBIN - State Bank of India</option>
                    </optgroup>
                    <optgroup label="Mutual Funds">
                        <option value="SBI-TAX|SBI Tax Saver Fund|MUTUAL_FUND">SBI Tax Saver Fund</option>
                        <option value="ICICI-PRUD|ICICI Prudential Life|MUTUAL_FUND">ICICI Prudential Life</option>
                    </optgroup>
                    <optgroup label="Commodities">
                        <option value="GOLD|Gold (per gram)|GOLD">Gold (per gram)</option>
                    </optgroup>
                </select>
            </div>

            <div class="form-group" style="display: none;">
                <label for="symbol">Symbol</label>
                <input id="symbol" type="text" readonly>
            </div>

            <div class="form-group" style="display: none;">
                <label for="holdingName">Name</label>
                <input id="holdingName" type="text" readonly>
            </div>

            <div class="form-group">
                <label for="quantity">Quantity *</label>
                <input id="quantity" type="number" placeholder="0" min="0.01" step="0.01" required>
            </div>

            <div class="form-group" style="display: none;">
                <label for="assetType">Asset Type</label>
                <input id="assetType" type="text" readonly>
            </div>

            <div class="form-group" style="display: none;">
                <label for="price">Purchase Price</label>
                <input id="price" type="number" readonly>
            </div>

            <div class="current-price-display" id="currentPriceDisplay" style="display: none;">
                <div class="price-info-box">
                    <div class="price-info">
                        <span class="price-label">Current Market Price:</span>
                        <span class="price-value" id="modalCurrentPrice">--</span>
                    </div>
                    <div class="price-note">
                        <small>This price will be used as your purchase price</small>
                    </div>
                </div>
            </div>

            <div class="loading-price" id="loadingPrice" style="display: none;">
                <div class="loading-spinner"></div>
                <span>Fetching live price...</span>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
                <button type="submit" class="btn-primary">Save Asset</button>
            </div>
        </form>
    </div>
</div>

<script src="dashboard.js"></script>
<script>
    // Theme initialization
    document.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('theme') || 'light';
        const themeIcon = document.querySelector('.theme-icon');

        document.body.classList.remove('light', 'dark');
        document.body.classList.add(savedTheme);
        themeIcon.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    });
</script>
</body>
</html>